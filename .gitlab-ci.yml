stages:
    - build
before_script:
    - npm install
build_prod:
    stage: build
    script:
        - echo $env:CI_JOB_ID
        - echo $env:GITLAB_USER_EMAIL
        - pwd
        - npm run build
        - cp -a ./pages/ /root/wikipedia-medication-extractor/pages
        - cp -a ./.next/ /root/wikipedia-medication-extractor/.next
        - cp -a ./.gitignore /root/wikipedia-medication-extractor/.gitignore
        - cp -a ./.gitlab-ci.yml /root/wikipedia-medication-extractor/.gitlab-ci.yml
        - cp -a ./package-lock.json /root/wikipedia-medication-extractor/package-lock.json
        - cp -a ./package.json /root/wikipedia-medication-extractor/package.json
        - cp -a ./README.md /root/wikipedia-medication-extractor/README.md
        - cp -a ./public /root/wikipedia-medication-extractor/public
        - cd /root/wikipedia-medication-extractor
        - npm install
        - sudo systemd restart wikiapi
        
    only:
        refs:
            - master
            - schedules
    tags: 
        - prod
        - production
